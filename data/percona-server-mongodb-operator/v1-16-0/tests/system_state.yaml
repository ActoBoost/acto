apiVersion: psmdb.percona.com/v1
kind: PerconaServerMongoDB
metadata:
  name: test-cluster
spec:
  backup:
    enabled: true
    image: percona/percona-backup-mongodb:2.4.1
    pitr:
      compressionLevel: 6
      compressionType: gzip
      enabled: false
      oplogOnly: false
  crVersion: 1.16.0
  image: percona/percona-server-mongodb:7.0.8-5
  imagePullPolicy: IfNotPresent
  pmm:
    enabled: false
    image: percona/pmm-client:2.41.2
    serverHost: monitoring-service
  replsets:
  - affinity:
      antiAffinityTopologyKey: kubernetes.io/hostname
    arbiter:
      affinity:
        antiAffinityTopologyKey: kubernetes.io/hostname
      enabled: false
      resources:
        limits:
          cpu: '1'
          memory: 1G
        requests:
          cpu: 300m
          memory: 0.5G
      size: 1
    configuration: "operationProfiling:\n  mode: slowOp\nsystemLog:\n  verbosity:\
      \ 1\nstorage:\n  engine: wiredTiger\n  wiredTiger:\n    engineConfig:\n    \
      \  directoryForIndexes: false\n      journalCompressor: snappy\n    collectionConfig:\n\
      \      blockCompressor: snappy\n    indexConfig:\n      prefixCompression: true\n"
    expose:
      enabled: false
      exposeType: ClusterIP
    name: rs0
    nonvoting:
      affinity:
        antiAffinityTopologyKey: kubernetes.io/hostname
      enabled: false
      podDisruptionBudget:
        maxUnavailable: 1
      resources:
        limits:
          cpu: '1'
          memory: 1G
        requests:
          cpu: 300m
          memory: 0.5G
      size: 3
      volumeSpec:
        persistentVolumeClaim:
          resources:
            requests:
              storage: 3Gi
    podDisruptionBudget:
      maxUnavailable: 1
    resources:
      limits:
        cpu: '1'
        memory: 1G
      requests:
        cpu: 300m
        memory: 0.5G
    size: 3
    volumeSpec:
      persistentVolumeClaim:
        resources:
          requests:
            storage: 3Gi
  secrets:
    encryptionKey: my-cluster-name-mongodb-encryption-key
    users: my-cluster-name-secrets
  sharding:
    configsvrReplSet:
      affinity:
        antiAffinityTopologyKey: kubernetes.io/hostname
      configuration: "operationProfiling:\n  mode: slowOp\nsystemLog:\n    verbosity:\
        \ 1\n"
      expose:
        enabled: false
        exposeType: ClusterIP
      podDisruptionBudget:
        maxUnavailable: 1
      resources:
        limits:
          cpu: '1'
          memory: 1G
        requests:
          cpu: 300m
          memory: 0.5G
      size: 3
      volumeSpec:
        persistentVolumeClaim:
          resources:
            requests:
              storage: 3Gi
    enabled: true
    mongos:
      affinity:
        antiAffinityTopologyKey: kubernetes.io/hostname
      expose:
        exposeType: ClusterIP
      podDisruptionBudget:
        maxUnavailable: 1
      resources:
        limits:
          cpu: '1'
          memory: 1G
        requests:
          cpu: 300m
          memory: 0.5G
      size: 3
  updateStrategy: SmartUpdate
  upgradeOptions:
    apply: disabled
    schedule: 0 2 * * *
    setFCV: false
    versionServiceEndpoint: https://check.percona.com